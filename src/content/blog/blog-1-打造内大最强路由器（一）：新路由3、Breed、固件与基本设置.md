---
title: 打造内大最强路由器（一）：新路由3、Breed、固件与基本设置
excerpt: 认证系统已更新，此文章已过时。
publishDate: 2021-03-29 09:10:00
tags:
  - 校园网
---

## 前言
本系列博文着重于操作，对于原理层面的知识则不太深究，毕竟我不是专业人士，水平有限。


## 选择路由器
推荐尽量选择在恩山论坛里人气比较高的路由器，这类路由器一般有很多固件可供选择，而且驱动也相对完整，不太容易出现莫名其妙的疑难杂症，性价比也相对很高。

在这里我选择的是新路由3。它有全千兆的网口，512M的DDR3内存，32M的闪存，MT7621A双核CPU以及1个USB3.0接口，作为寝室公用路由是完全足够的。

本系列博客也都是以新路由3为标准而写成的。


## 刷入Breed（不死）
Breed的作用相当于手机上的Bootload、Recovery，主要是给路由器更换固件时提供一个入口，有时还起到救砖的作用，所以也有人称它为“不死”。

现在在售的新路由3已经基本没有全新的了，大多可以让商家帮忙刷好Breed后再寄过来。我的新路由3就是如此，所以我并没有亲身尝试过这一步操作。

如果你是个强迫症患者，买了全新版本的新路由3的话，可以按照[恩山论坛的教程](https://www.right.com.cn/forum/thread-342918-1-1.html)刷入Breed。


## 刷入第三方固件
~~不刷第三方固件用什么新路由3。~~

新路由3有丰富的第三方固件资源，常见的有稳定易上手的Pandavan（老毛子），功能强大的Openwrt/Pandorabox，精于流控和多拨的高恪等等。

本系列博客教程都是基于Openwrt的。

进入正题，在断电状态下**摁住**路由器后面的**复位键**不放，**插上电源**等待。当路由器的全部指示灯出现了一阵鬼畜的闪烁之后，即可松开复位键，此时已经进入了Breed模式。

这个时候的路由器还没开启无线，所以必须通过网线连接电脑进入Breed控制台。

电脑端关闭所有的代理服务，浏览器访问192.168.1.1即可见到如下页面：

![img1](/img/blog1-img1.webp)

点击固件```更新```->```常规固件```，勾选“固件”并选择你所下载的固件，点击```上传```、```更新```。

![img2](/img/blog1-img2.webp)

静等进度条走完，固件更新完毕并重启。

此时请**不要拔掉网线**，因为你的无线功能可能还没有开启。在插着网线的情况下继续进行下列设置。


## 基本设置
浏览器访问192.168.1.1（对，还是这个地址）进入Openwrt的后台，默认用户名和密码分别为：
```
root       #用户名
password   #密码
```


### 开启无线功能：
第一步先到```网络```->```无线```页面查看是否启用了WIFI，如果没有，请手动开启。在基本设置里可以设置SSID和密码等相关参数，自行摸索。

![img3](/img/blog1-img3.webp)

在开启了无线功能之后，我们就可以拔掉网线，用Wi-Fi连接路由器继续进行了。


### 路由器时间同步：
这个算是比较重要的一步，因为每天晚上宿舍断电，可能就会导致路由器的时间出现偏移。当时间偏移到一定程度之后，连校园网认证服务器都会拒绝你的连接请求。

在```系统```->```系统```里，点击“同步浏览器时间”进行同步。

顺便把下面的```启用 NTP 客户端```勾上，```保存&应用```。不过这也是一个然并卵的功能，因为当你时间不正确的时候，你就连不上校园网；当你连不上校园网的时候，你就同步不了时间（摊手）。

所以当你哪天早上起床发现路由器没网，连认证页面都打不开的时候，先来这里检查一下时间是否正确。

![img4](/img/blog1-img4.webp)

~~+1s~~

### 连接网络：
接下来到```网络```->```接口```里查看WAN口是否是```DHCP 客户端```模式，并且获取到了以10.xx开头的内网IPv4。如果没有的话，点击WAN接口的修改按钮：

![img5](/img/blog1-img5.webp)

将协议切换到```DHCP 客户端```，```保存&应用```。回到```网络```->```接口```页面，等待网络中心给你分配内网IP。

当成功获取到IPv4地址的时候，你就可以进入[校园网登录页面](http://172.31.99.50:802/srun_portal_pc.php?ac_id=2&)进行认证上网了。

接口里面的设置只需要做一次，重启也不会丢失。而校园网则需要每次重启之后都进行手动认证，这个操作其实挺烦人的，常常会因为没有认证而导致手机、电脑不自动连接Wi-Fi。至于如何实现在路由器开机时自动进行校园网认证，这个我们后面再谈。

### 端口映射：
由于公网IPv4地址数量已经逐渐无法满足需求，中国在很多年前就基本不主动分发公网地址了，改为分发内网IP，多个内网用户共用1个公网IP。

而在校园网里，情况可能就更复杂，除了学校内网之外，可能还隔着一层运营商内网。这种情况下，P2P的连接性，以及连接的稳定性就堪忧了。

而端口映射就较好的解决了这个问题，它就相当于一个虫洞，直接贯穿客户端至公网IP的某个端口，变相实现了拥有公网IP的效果（拥有部分端口已经可以解决大部分需求了）。

不扯了，开启方法：

```服务```->```UPnP```，勾选下方的```启动 UPnP 与 NAT-PMP 服务```，```保存&应用```。

![img6](/img/blog1-img6.webp)

如果有支持端口映射的程序在运行的话，相关信息将会显示在这个页面。

![img7](/img/blog1-img7.webp)


## 未测试的操作：硬件改装、修改EEPROM
**这些是相对危险的操作，我并未实际测试过！！！**

新路由3的内部结构相对来说不是那么完美，某些地方如果加上电容、屏蔽罩会更好，而且在极端发热（例如挖矿）的环境下会导致里面的硅油漏出来。可以通过改装解决这些问题，参考恩山论坛[帖子](https://www.right.com.cn/forum/thread-506529-1-1.html)。要是有强迫症但是没有动手能力的话，也可以通过某宝解决。

EEPROM分区里主要存储了发射功率相关的参数，刷入好的EEPROM能使你的无线信号和无线传输速率有较为明显的提升。有强迫症需求的话可以参考[这里](https://www.right.com.cn/forum/thread-426288-1-1.html)和[这里](https://www.right.com.cn/forum/forum.php?mod=viewthread&tid=428424&ctid=246)，不要忘记在刷入前备份自己的EEPROM，以及还要[注意修改MAC地址](https://www.right.com.cn/forum/forum.php?mod=viewthread&tid=430518&ctid=246)。

而实际上，我们的寝室只有十多平米，校园网带宽只有百兆，即使不做这些危险操作，满足需求也是绰绰有余的。


## 预告
本篇仅仅是介绍了路由器的一些基本设置，实现了最基本的上网需求。而在后续的博文中，将会陆续实现校园网自动认证、单线多拨实现带宽叠加（伪）、IPv6的实现等，敬请期待。